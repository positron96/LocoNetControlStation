# This is a short memo about DCC packets

*Documentation:*

On basic packets: https://www.nmra.org/sites/default/files/s-92-2004-07.pdf[]

On extended packets: https://www.nmra.org/sites/default/files/s-9.2.1_2012_07.pdf

Example of extended accessory packet addressing: https://github.com/JMRI/JMRI/blob/master/java/src/jmri/NmraPacket.java#L652

Preamble is 12 "1" bits. DCC++ uses 22 bits. Preamble is followed by "0" bit

```
PPP - preamble
EEEE-EEEE - Error Detection Data Byte = XOR of all previous bytes

Base packet (S-9.2)
===================

PPP 0 0AAA-AAAA 0 01DC-SSSS 0 EEEE-EEEE 1  Speed and Direction Packet For Locomotive Decoders (7-bit). S-9.2#36
                    D                      dir (1=FWD)
                       SSSS                14-steps speed
                      C                    lowest bit of 28-steps speed or F0, see S-9.2#48

Of note:

PPP 0 0000-0000 0 0000-0000 0 0000-0000 1  - Digital Decoder Reset Packet For All Decoders S-9.2#74

PPP 0 1111-1111 0 0000-0000 0 1111-1111 1  - Digital Decoder Idle Packet For All Decoders S-9.2#89

PPP 0 0000-0000 0 01DC-000S 0 EEEE-EEEE 1  - Digital Decoder Broadcast Stop Packets For All Decoders S-9.2#99
                          S                - 0=stop, 1=coast (stop delivering energy to motors)
                    D                      - dir
                     C                     - 2= D(dir) may be ignored

Extended packets (S-9.2.1)
==========================

Addresses:
      0000-0000  - Broadcast
      0AAA-AAAA  - 7-bit Locomotive address
      10AA-AAAA  - Basic Accessory Decoder with 9 bit address, first 6 bit
      11AA-AAAA
        AA-AAAA 0 AAAA-AAAA - 192-231 - 14-bit Locomotive decoder address
                 - 232-252 - Reserved
                 - 253-254 - Advanced Extended Packet
      1111-1111  - Idle packet

Instructions (S-9.2.1 #93):

PPP 0 AAAA-AAAA 0 CCCD-DDDD (...) 0 EEEE-EEEE 1
                            (...) - may be 0, 1 or 2 bytes, depending on CCC
                    |
 +------------------+
 |
CCCD-DDDD
0000      - Decoder Control
0000-0000 - Decoder reset
0001      - Consist Control
001G-GGGG 0 DDDD-DDDD        - Advanced Operations
   1-1111 0 CDDD-DDDD        - 128 steps speed
            C                - dir (1=FWD)
             DDD-DDDD        - 128 steps speed, normal bit order
   1-1101 0 VVVV-VVVV 0 DDDD-DDDD - Analog function group
            0000-0001             - Volume, all other are reserved
                        DDDD-DDDD - Analog function data 0..255

01DC-SSSS                    - 14/28 speed and dir (as in Basic packet)
100D-DDDD                    - F0,F4,F3,F2,F1
1011-DDDD                    - F8,F7,F6,F5
1010-DDDD                    - F12,F11,F10,F9
110G-GGGG                    - Feature expansion instruction
    0-0000 0 DLLL-LLLL 0 HHHH-HHHH - Binary state control (long) (2.3.6.1). States 1-15 reserved for RailCom
    0-0001 0 CC               - Time/Date (2.3.6.2)  ! Address must be 0
            00MM-MMMM 0 WWWH-HHHH 0 U0BB-BBBB  - Time
            010T-TTTT 0 MMMM-YYYY 0 YYYY-YYYY  - Date
    1-1101 0 DLLL-LLLL        - Binary state control (short) (2.3.6.4)
                                States 1-15 are reserved for RailCom
    0-0010 0 MMMM-MMMM 0 MMMM-MMMM  - System time (2.3.6.3) ms since startup. ! Address must be 0
    1-1110 0 DDDD-DDDD       - F20..F13 (2.3.6.5, TN-4.0.5)
    1-1111 0 DDDD-DDDD       - F28..F21 (2.3.6.6)
    1-1000 0 DDDD-DDDD       - F36..F29 (2.3.6.7)
111                         - CV access (2.3.7.1)
1111-GGGG 0 DDDD-DDDD 0 DDDD-DDDD - CV access (short)
1110-GGVV 0 VVVV-VVVV 0 DDDD-DDDD - CV access (long)
      01 - Verify byte
      11 - Write byte
      10 - Bit manipulation (verify/write one bit)


Basic Accessory Decoder Packet
==============================

PPP 0 10AA-AAAA 0 1aaa-CDDR 0- Basic Accessory Decoder Packet Format (9/11-bit address) S-9.2.1#420
                   aaa                    - high bits of address, in 1's complement
                       C                  - activate or deactivate
                        DD                - output pair or 2 lowest bits of 11-bit address
                          R               - thrown/closed

PPP 0 10AA-AAAA 0 0aaa-0AA1 0 000X-XXXX  - Extended Accessory Decoder Control Packet  S-9.2.1#436
        AA-AAAA    aaa  AA                            - 11-bit address
                   aaa                                - 1's complement, highest 3 bits of address
                        AA                            - lowest 2 bits of address
                                 X-XXXX               - aspect to be shown. 0=stop aspect
                          0 0 1110-GGVV 0 VVVV-VVVV 0 DDDD-DDDD  - Ops mode programming (see CV access)

PPP 0 1011-1111 0 1000-CDDD 0 EEEE-EEEE 1 - broadcast for basic accessory decoders  S-9.2.1#447

PPP 0 1011-1111 0 0000-0111 0 000X-XXXX 0 EEEE-EEEE 1 - broadcast for extended accessory decoders  S-9.2.1#456

```
